<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>2025å¹´ã‚’é§†ã‘æŠœã‘ã‚‹å¹´è³€çŠ¶</title>
    <style>
        :root {
            /* åŸºæœ¬ã‚µã‚¤ã‚º */
            --canvas-width: 680px;
            --canvas-height: 456px;
            --cal-width: 420px;

            /* ã‚°ãƒªãƒƒãƒ‰é…ç½® */
            --grid-top: 110px;
            --grid-left: 15px;
            --grid-width: 390px;
            --grid-height: 340px;

            /* ãƒã‚¹ã®è‰² */
            --bg-gold:   rgba(255, 215, 0, 0.3);
            --bg-purple: rgba(147, 112, 219, 0.3);
            --bg-blue:   rgba(0, 191, 255, 0.3);
            --bg-pink:   rgba(255, 105, 180, 0.4);
            --bg-green:  rgba(46, 204, 113, 0.3);
            --bg-orange: rgba(230, 126, 34, 0.3);
            --bg-red:    rgba(220, 20, 0, 0.5);
            
            /* ãƒ•ã‚©ãƒ³ãƒˆ */
            --font-main: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", sans-serif;
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #f0f0f0;
            font-family: var(--font-main);
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
        #game-container {
            position: relative;
            width: var(--canvas-width);
            height: var(--canvas-height);
            background-color: #fff;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            display: flex;
            overflow: hidden;
            margin-top: 20px;
        }

        /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
        .sidebar {
            width: 130px;
            height: 100%;
            background: #2c3e50;
            color: white;
            padding: 15px 10px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 20;
        }
        .status-label { font-size: 11px; color: #95a5a6; margin-bottom: 2px; text-transform: uppercase; }
        .status-value { font-size: 18px; font-weight: bold; color: #f1c40f; transition: color 0.3s; }
        .multiplier-value { color: #2ecc71; }
        /* ã‚‚ã—CSSå´ã«æ›¸ããŸã„å ´åˆã¯ã“ã¡ã‚‰ */
        #dice-cost-display {
            color: #ecf0f1; /* æ˜ã‚‹ã„ã‚°ãƒ¬ãƒ¼ */
            letter-spacing: 1px;
        }

        /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¨ãƒªã‚¢ */
        .calendar-area { position: relative; width: var(--cal-width); height: 100%; }
        #calendar-bg { width: 100%; height: 100%; display: block; }
        #grid-overlay {
            position: absolute;
            top: var(--grid-top); left: var(--grid-left);
            width: var(--grid-width); height: var(--grid-height);
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: repeat(6, 1fr);
        }
        .cell { border: 1px solid rgba(0,0,0,1); transition: background-color 0.3s; }

        /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é§’ */
        #player-token {
            position: absolute;
            width: 28px; height: 28px;
            background: #e74c3c;
            border: 2px solid #fff;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: all 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28);
            transform: translate(-50%, -50%);
            z-index: 10;
            pointer-events: none;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        #modal-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        #bonus-modal {
            background: white; padding: 25px; border-radius: 15px; text-align: center; width: 260px;
        }
        .bonus-option {
            display: block; width: 100%; margin: 10px 0; padding: 12px;
            background: #f1c40f; border: none; border-radius: 8px;
            font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        .bonus-option:hover { background: #f39c12; transform: translateY(-2px); }

        /* UIã‚¨ãƒªã‚¢ */
        .controls { margin-top: 25px; text-align: center; width: var(--canvas-width); }
        button#dice-btn {
            padding: 12px 40px; font-size: 20px; font-weight: bold;
            background: #3498db; color: white; border: none; border-radius: 50px;
            cursor: pointer; box-shadow: 0 4px #2980b9;
        }
        button#dice-btn:active { transform: translateY(2px); box-shadow: 0 2px #2980b9; }
        body.modal-open .controls button { pointer-events: none; opacity: 0.5; filter: grayscale(1); }

        #status-log { color: #666; margin-top: 15px; font-size: 0.9em; }

        #event-log {
            font-size: 1em;
            color: #2c3e50;
            height: 120px;       /* ãƒ­ã‚°ã‚¨ãƒªã‚¢ã®å›ºå®šé«˜ */
            overflow-y: auto;    /* ç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ‰åŠ¹ã« */
            margin-top: 10px;
            padding: 10px;
            background: rgba(255,255,255,0.5);
            border-radius: 8px;
            text-align: left;    /* ãƒ­ã‚°ã¯è¦‹ã‚„ã™ã„ã‚ˆã†ã«å·¦å¯„ã› */
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        /* ãƒ­ã‚°ã®ä¸€è¡Œãšã¤ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .log-entry {
            border-bottom: 1px solid #ddd;
            padding-bottom: 3px;
            animation: fadeInDown 0.3s ease-out; /* æ–°ã—ã„ãƒ­ã‚°ãŒãµã‚ã£ã¨å‡ºã‚‹æ¼”å‡º */
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ç‰¹æ®Šã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¹ã®å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .cell.special-day {
            background-color: transparent !important; /* èƒŒæ™¯ã¯ç™½ */
            border: 4px double transparent !important; /* äºŒé‡ç·šã®åœŸå°ï¼ˆé€æ˜ï¼‰ */
            border-image: linear-gradient(45deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #8b00ff) 1 !important;
            position: relative;
            z-index: 5;
            animation: rainbow-glow 3s linear infinite; /* è™¹è‰²ã‚’å‹•ã‹ã™æ¼”å‡º */
        }

        /* è™¹è‰²ã‚’ã‚­ãƒ©ã‚­ãƒ©ã•ã›ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes rainbow-glow {
            0% { filter: hue-rotate(0deg); box-shadow: 0 0 5px rgba(255,255,255,0.5); }
            50% { box-shadow: 0 0 15px rgba(255,255,255,0.8); }
            100% { filter: hue-rotate(360deg); box-shadow: 0 0 5px rgba(255,255,255,0.5); }
        }

    </style>
</head>
<body>

    <div id="game-container">
        <div class="sidebar">
            <div>
                <div class="status-label">æ‰€æŒé‡‘</div>
                <div id="money-display" class="status-value">0å††</div>
            </div>
            <div>
                <div class="status-label">ç¾åœ¨ã®æœˆ</div>
                <div id="month-display" style="font-size: 18px; font-weight: bold;">1æœˆ</div>
            </div>
        </div>
        
        <div class="calendar-area">
            <img id="calendar-bg" src="calendar/01gatu.png" alt="Calendar">
            <div id="grid-overlay"></div>
            <div id="player-token"></div>
        </div>

        <div class="sidebar" style="border-left: 1px solid #1a252f;">
            <div>
                <div class="status-label">åå…¥å€ç‡</div>
                <div class="status-value multiplier-value">x<span id="multiplier-display">1.0</span></div>
            </div>
            <div style="margin-top: 20px;">
                <div class="status-label">ã‚µã‚¤ã‚³ãƒ­ä»£</div>
                <div id="dice-cost-display" class="status-value" style="color: #bdc3c7; font-size: 16px;">1,000å††</div>
            </div>
        </div>

        <div id="modal-overlay">
            <div id="bonus-modal">
                <h3>ğŸŒ™ æ¯æœˆãƒœãƒ¼ãƒŠã‚¹</h3>
                <p style="font-size: 0.9em; color: #666;">ãƒœãƒ¼ãƒŠã‚¹ã‚’é¸ã‚“ã§ãã ã•ã„</p>
                <button class="bonus-option" onclick="applyBonus('money')">ğŸ’°  æ‰€æŒé‡‘ +50000å††</button>
                <button class="bonus-option" onclick="applyBonus('move')">ğŸƒ 3ãƒã‚¹é€²ã‚€</button>
                <button class="bonus-option" onclick="applyBonus('multiplier')">ğŸ“ˆ å€ç‡ +0.2</button>
            </div>
        </div>

        <div id="event-modal-overlay" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 110; flex-direction: column; justify-content: center; align-items: center;">
            <div id="event-special-content" style="background: white; padding: 20px; border-radius: 15px; text-align: center; width: 320px; box-shadow: 0 0 30px rgba(255,255,255,0.2);">
                <h2 id="special-event-title" style="margin-top: 0; color: #333; font-size: 1.2em;"></h2>
                <img id="special-event-img" src="" style="width: 100%; height: auto; border-radius: 10px; margin: 10px 0;">
                <p id="special-event-text" style="color: #555; font-size: 0.9em; line-height: 1.5;"></p>
                
                <div id="special-event-buttons" style="display: flex; gap: 10px; justify-content: center; margin-top: 15px;">
                    </div>
            </div>
        </div>
    </div>

    <div class="controls">
        <button id="dice-btn" onclick="rollDice()">ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã‚‹</button>
        <p id="status-log">2025å¹´ã‚¹ã‚¿ãƒ¼ãƒˆï¼</p>
        <p id="event-log"></p>
    </div>

<script>
    // ==========================================
    // 1. ã‚²ãƒ¼ãƒ è¨­å®šï¼ˆã“ã“ã‚’èª¿æ•´ã—ã¦ãƒãƒ©ãƒ³ã‚¹ã‚’å¤‰ãˆã‚‹ï¼‰
    // ==========================================
    const GAME_CONFIG = {
        DICE_COST: 1000,
        GOLD_MIN: 10000,
        GOLD_MAX: 50000,
        PURPLE_MIN: 20000,
        BONUS_MONEY_BASE: 50000,   // ãƒœãƒ¼ãƒŠã‚¹ã®åŸºæœ¬é¡
        BONUS_MULTIPLIER_ADD: 0.2, // å€ç‡ä¸Šæ˜‡é‡
        BONUS_MOVE_STEPS: 3,       // è¿½åŠ ã§é€²ã‚€æ­©æ•°
        COLORS: {
            TEXT_GOLD: "#f1c40f",
            TEXT_DEBT: "#ff4d4d"
        },
        EVENT_WEIGHTS: {
            1: 10, // é‡‘ï¼šãã“ãã“å‡ºã‚‹
            2: 8,  // ç´«ï¼šå‡ºã™ãã‚‹ã¨è¾›ã„ã®ã§å°‘ã—æŠ‘ãˆã‚‹
            3: 12, // é’ï¼šæˆé•·è¦ç´ ãªã®ã§å¤šã‚
            4: 5,  // æ¡ƒï¼šå†è¡Œå‹•ã¯å¼·åŠ›ãªã®ã§å°‘ãªã‚
            5: 15, // ç·‘ï¼šå®‰å®šãƒã‚¹ã€ä¸€ç•ªå‡ºã‚„ã™ã„
            6: 7,  // æ©™ï¼šæŠ•è³‡ã¯è¨ˆç”»çš„ã«
            7: 3   // èµ¤ï¼šå¤§é€†è»¢ã¯ãƒ¬ã‚¢
        },
        // ç©ºç™½ãƒã‚¹ã®ç¢ºç‡ï¼ˆ0ã«ã™ã‚‹ã¨å…¨éƒ¨åŸ‹ã¾ã‚‹ã€10ãªã©ã«ã™ã‚‹ã¨ä½•ã‚‚èµ·ããªã„æ—¥ãŒã§ãã‚‹ï¼‰
        EMPTY_WEIGHT: 15
    };

    const EVENT_TYPES = {
        1: { name: "é‡‘ãƒã‚¹", color: "var(--bg-gold)" },
        2: { name: "ç´«ãƒã‚¹", color: "var(--bg-purple)" },
        3: { name: "é’ãƒã‚¹", color: "var(--bg-blue)" },
        4: { name: "æ¡ƒãƒã‚¹", color: "var(--bg-pink)" },
        5: { name: "ç·‘ãƒã‚¹", color: "var(--bg-green)" },
        6: { name: "æ©™ãƒã‚¹", color: "var(--bg-orange)" },
        7: { name: "èµ¤ãƒã‚¹", color: "var(--bg-red)" }
    };

    const MONTHS_DATA = [
        { name: "1æœˆ", img: "calendar/01gatu.png", offset: 3, days: 31, events: { 1:1, 2:2, 3:3, 4:4, 5:1, 6:2, 7:3, 8:4, 9:1, 10:2, 11:3, 12:4, 13:1, 14:2, 15:3, 16:4, 17:1, 18:2, 19:3, 20:4, 21:1, 22:2, 23:3, 24:4, 25:1, 26:2, 27:3, 28:4, 29:1, 30:2, 31:3 } },
        { name: "2æœˆ", img: "calendar/02gatu.png", offset: 6, days: 28, events: { 11:4, 14:3, 20:1 } },
        { name: "3æœˆ", img: "calendar/03gatu.png", offset: 6, days: 31, events: { 11:4, 14:3, 20:1 } },
        { name: "4æœˆ", img: "calendar/04gatu.png", offset: 2, days: 30, events: { 11:4, 14:3, 20:1 } },
        { name: "5æœˆ", img: "calendar/05gatu.png", offset: 4, days: 31, events: { 11:4, 14:3, 20:1 } },
        { name: "6æœˆ", img: "calendar/06gatu.png", offset: 0, days: 30, events: { 11:4, 14:3, 20:1 } },
        { name: "7æœˆ", img: "calendar/07gatu.png", offset: 2, days: 31, events: { 11:4, 14:3, 20:1 } },
        { name: "8æœˆ", img: "calendar/08gatu.png", offset: 5, days: 31, events: { 11:4, 14:3, 20:1 } },
        { name: "9æœˆ", img: "calendar/09gatu.png", offset: 1, days: 30, events: { 11:4, 14:3, 20:1 } },
        { name: "10æœˆ", img: "calendar/10gatu.png", offset: 3, days: 31, events: { 11:4, 14:3, 20:1 } },
        { name: "11æœˆ", img: "calendar/11gatu.png", offset: 6, days: 30, events: { 11:4, 14:3, 20:1 } },
        { name: "12æœˆ", img: "calendar/12gatu.png", offset: 1, days: 31, events: { 11:4, 14:3, 20:1 } }
    ];


    // ç‰¹å®šã®æ—¥ä»˜ã«ç™ºç”Ÿã™ã‚‹å›ºå®šã‚¤ãƒ™ãƒ³ãƒˆ
    const SPECIAL_DATE_EVENTS = {
        "1-1": {
            title: "ğŸ ã‚ã‘ã¾ã—ã¦ãŠã‚ã§ã¨ã†",
            img: "images/2025.jpg",
            text: "ãŠå¹´ç‰ã‚’ã‚‚ã‚‰ã„ã¾ã—ãŸï¼æ‰€æŒé‡‘ãŒ30,000å††ã‚¢ãƒƒãƒ—ï¼",
            action: () => {
                addMoney(30000, "ãŠå¹´ç‰");
            }
        },
        "1-21": {
            title: "ğŸ¨ æ„›â™¡ã‚¹ã‚¯ãƒªï½ãƒ ï¼",
            img: "images/aice.jpg",
            text: "ãƒ«ãƒ“ã‚£ã¡ã‚ƒãƒ¼ã‚“ï¼ã¯ãƒ¼ã„ï¼ä½•ãŒå¥½ãï¼Ÿãƒãƒ§ã‚³ãƒŸãƒ³ãƒˆã‚ˆã‚Šã‚‚ ã‚ãƒ»ãªãƒ»ãŸ",
            action: () => {
                addMoney(50000, "ãƒãƒ§ã‚³ãƒŸãƒ³ãƒˆ");
            }
        },
        "2-14": {
            title: "ğŸ« ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³",
            img: "images/ehho.png",
            text: "ã€Œã‚¨ãƒƒãƒ›ã‚¨ãƒƒãƒ› ã‚¢ãƒ³ãƒ‘ãƒ³ãƒãƒ³ã¯ã¤ã¶ã‚ã‚“ã£ã¦ä¼ãˆãªãã‚ƒã€ã‚¢ãƒ³ãƒ‘ãƒ³ã‚’5ä¸‡å††ã§ä»•å…¥ã‚Œã¦é…ã‚Šã¾ã™ã‹ï¼Ÿï¼ˆåå…¥å€ç‡ãŒ0.5ã‚¢ãƒƒãƒ—ã—ã¾ã™ï¼‰",
            options: [
                {
                    label: "ã¯ã„ï¼ˆ-5ä¸‡å††ï¼‰",
                    color: "#e74c3c",
                    action: () => {
                        if (state.money >= 50000) {
                            subMoney(50000, "ã‚¨ãƒƒãƒ›ã‚¨ãƒƒãƒ›");
                            updateMultiplier(0.5, "ã‚¢ãƒ³ãƒ‘ãƒ³ãƒãƒ³ã¯ã¤ã¶ã‚ã‚“ã£ã¦ä¼ãˆãªãã‚ƒ");
                        } else {
                            pushLog("ãŠé‡‘ãŒè¶³ã‚Šãªãã¦ã‚¢ãƒ³ãƒ‘ãƒ³ãŒè²·ãˆã¾ã›ã‚“ã§ã—ãŸâ€¦");
                        }
                    }
                },
                {
                    label: "ã„ã„ãˆ",
                    color: "#95a5a6",
                    action: () => {
                        pushLog("ã‚¢ãƒ³ãƒ‘ãƒ³ã¯ã‚¹ãƒ«ãƒ¼ã—ã¾ã—ãŸã€‚");
                    }
                }
            ]
        },
        "4-13": {
            title: "ğŸ¡ å¤§é˜ªãƒ»é–¢è¥¿ä¸‡åš é–‹å¹•ï¼",
            img: "images/myaku.jpg",
            text: "ãƒŸãƒ£ã‚¯å†–æ§˜ï¼",
            options: [
                {
                    label: "ä¸‡åšã«è¡Œãï¼ˆ-5ä¸‡å††ï¼‰",
                    color: "#e74c3c",
                    action: () => {
                        if (state.money >= 50000) {
                            subMoney(50000, "ä¸‡åšå…¥å ´æ–™");
                            updateMultiplier(0.5, "50å¹´ã«ä¸€åº¦ã®ä½“é¨“");
                        } else {
                            pushLog("è³‡é‡‘ä¸è¶³ã§ä¸‡åšã«è¡Œã‘ã¾ã›ã‚“ã§ã—ãŸâ€¦");
                        }
                    }
                },
                {
                    label: "è¡Œã‹ãªã„",
                    color: "#3498db",
                    action: () => {
                        pushLog("ä¸‡åšã«è¡Œãã¾ã›ã‚“ã§ã—ãŸ");
                    }
                }
            ]
        },
        "5-2": {
            title: "ã‚¤ãƒã‚½åˆˆã‚Šãƒ¡ã‚¿ãƒ¢ãƒ³",
            img: "images/meta.jpg",
            text: "ã™ã”ã„(https://www.pixiv.net/users/20522049)",
            action: () => {
                updateMultiplier(0.5, "ãƒ¡ã‚¿ãƒ¢ãƒ³");
            }
        },
        "5-9": {
            title: "çŒ«å½±ãƒãƒ¼ã‚º",
            img: "images/kageneko.jpg",
            text: "ã„ã„ã‚ˆã­",
            action: () => {
                addMoney(10000, "å½±çŒ«");
            }
        },
        "5-31": {
            title: "ãŠè¿”äº‹ã¾ã ã‚«ãƒŠ?ãŠã˜ã•ã‚“æ§‹æ–‡!",
            img: "images/ozi.jpg",
            text: "å€‹äººçš„ã«ä¸€éæ€§ã®ãƒã‚¿ç³»ã¯å¥½ã¿ã§ãªã„ãŒã€æ›²ã¯è‰¯ã„ã¨æ€ã†",
            action: () => {
                addMoney(10000, "ãŠã˜ã•ã‚“æ§‹æ–‡");
            }
        },
        "6-17": {
            title: "Shadowverse: Worlds Beyond",
            img: "images/syad.jpg",
            text: "ç§ã¯åŠå¹´ã‚‚ã“ã‚“ãªã‚²ãƒ¼ãƒ ã‚„ã£ã¦ã‚‹ã®ã‹",
            action: () => {
                updateMultiplier(0.1, "ã‚·ãƒ£ãƒ‰ãƒ");
            }
        },
        "6-21": {
            title: "",
            img: "images/naruto.png",
            text: "åå…¥å€ç‡ãŒ0.5ã‚¢ãƒƒãƒ—ã§ä»Šã“ã‚Œ",
            action: () => {
                updateMultiplier(0.5, "ä»Šã“ã‚Œ");
            }
        },
        "6-24": {
            title: "æ©Ÿå‹•æˆ¦å£«Gundam GQuuuuuuX",
            img: "images/ganda.jpg",
            text: "ã‚¬ãƒ³ãƒ€ãƒ åˆè¦‹ã ã£ãŸã‘ã©é¢ç™½ã‹ã£ãŸã‚ˆ",
            action: () => {
                updateMultiplier(0.2, "ã‚¬ãƒ³ãƒ€ãƒ ");
            }
        },
        "7-10": {
            title: "å®¹æ…‹æ€¥å¤‰ã€FULLã€‘",
            img: "images/asmr.jpg",
            text: "ã“ã‚ŒBANã•ã‚Œãªã„ã‹ï¼Ÿ",
            action: () => {
                subMoney(30000, "å®¹æ…‹æ€¥å¤‰ã€FULLã€‘");
            }
        },
        "7-15": {
            title: "Grok Ani",
            img: "images/ani.jpg",
            text: "ã‚¤ãƒ¼ãƒ­ãƒ³ã®è¶£å‘³ã€æ‚ªããªã„èª¬",
            action: () => {
                addMoney(20000, "Ani");
            }
        },
        "7-18": {
            title: "åŠ‡å ´ç‰ˆã€Œé¬¼æ»…ã®åˆƒã€ç„¡é™åŸç·¨ ã€ç¬¬ä¸€ç«  çŒ—çª©åº§å†æ¥ã€",
            img: "images/akaza.jpg",
            text: "ãŠå‰ã‚‚é¬¼ã«ãªã‚‰ãªã„ã‹ï¼Ÿ",
            options: [
                {
                    label: "é¬¼ã«ãªã‚‹ï¼ˆ10ä¸‡ç²å¾—ã—ã€å€ç‡-0.6ï¼‰",
                    color: "#e74c3c",
                    action: () => {
                        updateMultiplier(-0.9, "é¬¼ã«ãªã£ãŸ");
                        addMoney(300000, "é¬¼ã«ãªã£ãŸ")
                    }
                },
                {
                    label: "ãªã‚‰ãªã„ï¼ï¼ˆ10ä¸‡å¤±ã†ï¼‰",
                    color: "#3498db",
                    action: () => {
                        subMoney(100000, "é¬¼ã«ãªã‚‰ãªã‹ã£ãŸ");
                    }
                }
            ]
        },
        "7-19": {
            title: "é­”æ³•å°‘å¥³ãƒé­”å¥³è£åˆ¤",
            img: "images/manosa.jpg",
            text: "âœ‹ã€Œã¡ã‚‡ã£ã¨å¾…ã£ã¦ï¼ã€å€‹äººçš„ç¥ã‚²ãƒ¼ãªã®ã§æ˜¯é",
            action: () => {
                addMoney(10000, "ç‚™ã‚Šç“¶")
            }
        },
        "7-21": {
            title: "wplace",
            img: "images/place.jpg",
            text: "ãã£ã“ãƒ¼ã§è’ã‚‰ã•ã‚Œã¦å¯å“€ãã†ã ã£ãŸ",
            action: () => {
                addMoney(10000, "wplace")
            }
        },
        "8-20": {
            title: "ã¾ã‚‹ã§æœ¬ç‰©ã®ã‚ˆã†ã§ã™",
            img: "images/same.jpg",
            text: "å®¶ã§ã‚‚ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ã§ã‚‚ã€ã‚¨ãƒƒãƒãªæœã‚’ç€ã¦å‹é”ã‚„å®¶æ—ã‚’æ€–ãŒã‚‰ã›ã¾ã—ã‚‡ã†ï¼",
            action: () => {
                updateMultiplier(0.2, "æ€–ãŒã‚‰ã›ã¾ã—ã‚‡ã†ï¼");
            }
        },
        "9-8": {
            title: "ã†ã¾ããƒ˜ãƒƒãƒ€ãƒ¼ã«åã¾ã‚‰ãªã„",
            img: "images/header.png",
            text: "ã†ã¾ãã„ã£ãŸã®ã§ãƒ˜ãƒƒãƒ€ãƒ¼è¦‹ã¦ãã ã•ã„",
            action: () => {
                addMoney(10000, "ãƒ˜ãƒƒãƒ€ãƒ¼")
            }
        },
        "9-10": {
            title: "ã‚²ã‚¤ãƒªãƒ¼ã«ã‚ã‚ŠãŒã¨ã†ã¨è¨€ã£ã¦",
            img: "images/itari.jpg",
            text: "ã‚²ã‚¤ãƒªãƒ¼ã¯ã‚ãªãŸãŒæ¯æ—¥é£Ÿã¹ã¦ã„ã‚‹ã‹ç¢ºã‹ã‚ãŸã„ã‚“ã ã€‚ã‚²ã‚¤ãƒªãƒ¼ã«ã‚ã‚ŠãŒã¨ã†ã¨è¨€ã£ã¦",
            options: [
                {
                    label: "ã‚ã‚ŠãŒã¨ã†",
                    color: "#e74c3c",
                    action: () => {
                        addMoney(10000, "ã‚ã‚ŠãŒã¨ã†")
                    }
                },
                {
                    label: "ã„ã‚ãªã„",
                    color: "#3498db",
                    action: () => {
                        pushLog(`ã‚²ã‚¤ãƒªãƒ¼ã«æ„Ÿè¬ã—ãªã‹ã£ãŸ`);
                    }
                }
            ]
        },
        "9-19": {
            title: "åŠ‡å ´ç‰ˆã€ãƒã‚§ãƒ³ã‚½ãƒ¼ãƒãƒ³ ãƒ¬ã‚¼ç¯‡ã€",
            img: "images/reze.png",
            text: "è‡ªèªãƒ¬ãœã§ã‚‚ã„ã„ã¨æ€ã„ã¾ã™ï¼ˆåå…¥å€ç‡ãŒ0.2ã‚¢ãƒƒãƒ—ï¼‰",
            action: () => {
                updateMultiplier(0.2, "BOM!");
            }
        },
        "9-23": {
            title: "ã‚¤ã‚¿ãƒªã‚¢ãƒ³ãƒ»ãƒ–ãƒ¬ã‚¤ãƒ³ãƒ­ãƒƒãƒˆ",
            img: "images/itari.pmg",
            text: "ãƒˆã‚¥ãƒ³ãƒˆã‚¥ãƒ³ãƒˆã‚¥ãƒ³â€¦â€¦ãƒˆã‚¥ãƒ³ãƒˆã‚¥ãƒ³ãƒˆã‚¥ãƒ³â€¦â€¦ï¼ˆåå…¥å€ç‡ãŒ0.1ã‚¢ãƒƒãƒ—ï¼‰",
            action: () => {
                updateMultiplier(0.1, "ä½•ã“ã‚Œ");
            }
        },
        "10-14": {
            title: "ãƒã‚±ãƒ¢ãƒ³ãƒ¬ã‚¸ã‚§ãƒ³ã‚º Z-A",
            img: "images/za.jpg",
            text: "å¥³è£…ã§ãã‚‹ã“ã¨ã—ã‹çŸ¥ã‚‰ãªã„",
            action: () => {
                addMoney(80000, "ãƒã‚±ãƒ¢ãƒ³")
            }
        },
        "10-16": {
            title: "ã‚¤ãƒŠã‚ºãƒã‚¤ãƒ¬ãƒ–ãƒ³ è‹±é›„ãŸã¡ã®ãƒ´ã‚£ã‚¯ãƒˆãƒªãƒ¼ãƒ­ãƒ¼ãƒ‰",
            img: "images/inazuma.jpg",
            text: "8å¹´è¶Šã—ã®ç™ºå£²ï¼",
            action: () => {
                addMoney(80000, "ã‚¤ãƒŠã‚ºãƒã‚¤ãƒ¬ãƒ–ãƒ³")
            }
        },
        "11-13": {
            title: "ã‚°ã‚¨ãƒ¼æ­»ã‚“ã ãƒ³ã‚´",
            img: "images/gue-.jpg",
            text: "",
            action: () => {
                state.money = Math.abs(state.money);
                pushLog(`æˆä»ã—ã¦ã‚¯ãƒ¬ãƒ¡ãƒ³ã‚¹ï¼ˆå€Ÿé‡‘ãŒã‚ã‚‹å ´åˆãƒ—ãƒ©ã‚¹ã«å¤‰åŒ–ï¼‰`);
            }
        },
        "12-25": {
            title: "ã†ãµï½ã‚“â™¡å¥³ã‚ˆï½ã‚“â™¡paypayã«é€é‡‘ã—ã¦ï½ã‚“â™¡",
            img: "images/noimage.png", // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ§˜ãŒç”¨æ„ã™ã‚‹ç”»åƒãƒ‘ã‚¹
            text: "ã†ãµï½ã‚“â™¡å¥³ã‚ˆï½ã‚“â™¡paypayã«é€é‡‘ã—ã¦ï½ã‚“â™¡",
            action: () => {
                addMoney(50000, "ã‚¯ãƒªã‚¹ãƒã‚¹ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ");
                updateMultiplier(0.5, "ã‚¯ãƒªã‚¹ãƒã‚¹ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ");
            }
        },
        "12-25": {
            title: "ğŸ„ ãƒ¡ãƒªãƒ¼ã‚¯ãƒªã‚¹ãƒã‚¹ï¼ï¼",
            img: "images/chicken.jpg", // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ§˜ãŒç”¨æ„ã™ã‚‹ç”»åƒãƒ‘ã‚¹
            text: "ã‚µãƒ³ã‚¿ã•ã‚“ã‹ã‚‰ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆï¼æ‰€æŒé‡‘ãŒ50,000å††ã‚¢ãƒƒãƒ—ã—ã€å€ç‡ãŒ0.5ä¸ŠãŒã‚Šã¾ã—ãŸï¼",
            action: () => {
                addMoney(50000, "ã‚¯ãƒªã‚¹ãƒã‚¹ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ");
                updateMultiplier(0.5, "ã‚¯ãƒªã‚¹ãƒã‚¹ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ");
            }
        }
    };

    // ==========================================
    // 2. çŠ¶æ…‹ç®¡ç† & DOMã‚­ãƒ£ãƒƒã‚·ãƒ¥
    // ==========================================
    let state = {
        currentMonthIdx: 0,
        currentDay: 1,
        money: 0,
        multiplier: 1.0
    };

    const UI = {
        overlay: document.getElementById('grid-overlay'),
        token: document.getElementById('player-token'),
        bg: document.getElementById('calendar-bg'),
        month: document.getElementById('month-display'),
        money: document.getElementById('money-display'),
        multiplier: document.getElementById('multiplier-display'),
        modal: document.getElementById('modal-overlay'),
        statusLog: document.getElementById('status-log'),
        eventLog: document.getElementById('event-log')
    };

    // ==========================================
    // 3. åŸºæœ¬ã‚·ã‚¹ãƒ†ãƒ 
    // ==========================================

    function initGrid() {
        UI.overlay.innerHTML = '';
        for (let i = 0; i < 42; i++) {
            const cell = document.createElement('div');
            cell.classList.add('cell');
            cell.id = `cell-${i}`;
            UI.overlay.appendChild(cell);
        }
        // ã‚µã‚¤ã‚³ãƒ­ä»£ã®è¡¨ç¤ºã‚’åˆæœŸåŒ–
        document.getElementById('dice-cost-display').innerText = GAME_CONFIG.DICE_COST.toLocaleString() + "å††";

        // 1æœˆã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç”Ÿæˆ
        generateMonthlyEvents(state.currentMonthIdx);

        updateCalendarVisuals();
        updateView();
    }

    function updateCalendarVisuals() {
        const monthIdx = state.currentMonthIdx;
        const month = MONTHS_DATA[monthIdx];
        
        document.querySelectorAll('.cell').forEach((cell, i) => {
            // å…¨ã¦ãƒªã‚»ãƒƒãƒˆ
            cell.style.backgroundColor = 'transparent';
            cell.classList.remove('special-day');
            
            const day = i - month.offset + 1;
            if (day >= 1 && day <= month.days) {
                const dateKey = `${monthIdx + 1}-${day}`;

                // ç‰¹æ®Šã‚¤ãƒ™ãƒ³ãƒˆãŒã‚ã‚‹ã‹åˆ¤å®š
                if (SPECIAL_DATE_EVENTS[dateKey]) {
                    // è™¹è‰²ã®äºŒé‡ç·šã‚¯ãƒ©ã‚¹ã‚’é©ç”¨
                    cell.classList.add('special-day');
                } else {
                    // é€šå¸¸ã®ãƒ©ãƒ³ãƒ€ãƒ ã‚¤ãƒ™ãƒ³ãƒˆã®è‰²
                    const eventId = month.events ? month.events[day] : null;
                    if (EVENT_TYPES[eventId]) {
                        cell.style.backgroundColor = EVENT_TYPES[eventId].color;
                    }
                }
            }
        });
    }

    function updateView(skipEvent = false) {
        const monthIdx = state.currentMonthIdx;
        const day = state.currentDay;
        const month = MONTHS_DATA[state.currentMonthIdx];
        UI.bg.src = month.img;
        UI.month.innerText = month.name;
        UI.multiplier.innerText = state.multiplier.toFixed(1);

        // ã‚¤ãƒ™ãƒ³ãƒˆåˆ¤å®š
        if (!skipEvent) {
            const dateKey = `${monthIdx + 1}-${day}`;
            if (SPECIAL_DATE_EVENTS[dateKey]) {
                const ev = SPECIAL_DATE_EVENTS[dateKey];
                showSpecialEvent(ev);
                if (ev.action) ev.action(); // è¨­å®šã•ã‚ŒãŸåŠ¹æœï¼ˆãŠé‡‘ã‚„å€ç‡ï¼‰ã‚’å®Ÿè¡Œ
            } else {
                // ç‰¹å®šæ—¥ã®ã‚¤ãƒ™ãƒ³ãƒˆãŒãªã„å ´åˆã®ã¿ã€é€šå¸¸ã®ãƒ©ãƒ³ãƒ€ãƒ ã‚¤ãƒ™ãƒ³ãƒˆã‚’å®Ÿè¡Œ
                const eventId = month.events ? month.events[day] : null;
                handleEvents(eventId);
            }
        }

        // é§’ã®ç§»å‹•
        const cellIndex = month.offset + state.currentDay - 1;
        const targetCell = document.getElementById(`cell-${cellIndex}`);
        
        if (targetCell) {
            // 1. ã‚»ãƒ«è‡ªèº«ã®ä¸­å¿ƒåº§æ¨™ã‚’è¨ˆç®—
            const centerX = targetCell.offsetLeft + (targetCell.offsetWidth / 2);
            const centerY = targetCell.offsetTop + (targetCell.offsetHeight / 2);

            // 2. è¦ªè¦ç´ ã§ã‚ã‚‹ #grid-overlay ã®ã‚ºãƒ¬ï¼ˆCSSå¤‰æ•°ã‹ã‚‰å–å¾—ï¼‰ã‚’è¶³ã™
            // ã“ã‚Œã«ã‚ˆã‚Šã€ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”»åƒä¸Šã®æ­£ã—ã„ä½ç½®ã«é§’ãŒç§»å‹•ã—ã¾ã™
            const gridShiftX = UI.overlay.offsetLeft;
            const gridShiftY = UI.overlay.offsetTop;

            UI.token.style.left = (centerX + gridShiftX) + 'px';
            UI.token.style.top = (centerY + gridShiftY) + 'px';
        }
    }

    function handleEvents(id) {
        if (!id) {
            pushLog(`ç‰¹ã«ãªã—`);
            return;
        }
        switch (id) {
            case 1: // é‡‘ï¼š1ä¸‡ï½5ä¸‡ï¼ˆå€ç‡é©ç”¨ï¼‰
                const randomBase = Math.floor(Math.random() * (GAME_CONFIG.GOLD_MAX / 100 - GAME_CONFIG.GOLD_MIN / 100 + 1) + GAME_CONFIG.GOLD_MIN / 100) * 100;
                addMoney(randomBase, "é‡‘ãƒã‚¹ ãƒ©ãƒƒã‚­ãƒ¼ï¼");
                break;
            case 2: // ç´«ï¼š2ä¸‡ï½ï¼ˆæ‰€æŒé‡‘+2ä¸‡ï¼‰ï¼ˆå›ºå®šå¼•ï¼‰
                const currentUpperLimit = Math.max(GAME_CONFIG.PURPLE_MIN, state.money + 20000);
                const randomLoss = Math.floor(Math.random() * (currentUpperLimit / 100 - GAME_CONFIG.PURPLE_MIN / 100 + 1) + GAME_CONFIG.PURPLE_MIN / 100) * 100;
                subMoney(randomLoss, "ç´«ãƒã‚¹ å¤±æ•—ï¼");
                break;
            case 3: // é’ï¼šå€ç‡ã‚¢ãƒƒãƒ—
                updateMultiplier(0.1, "é’ãƒã‚¹ æˆé•·ï¼");
                break;
            case 4: // æ¡ƒï¼šå†è¡Œå‹•
                pushLog(`æ¡ƒãƒã‚¹ï¼šã‚„ã‚‹æ°—ãŒã¿ãªãã‚‹ï¼ã‚‚ã†ä¸€åº¦ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã‚Šã¾ã™ã€‚`);
                // rollDiceã‚’ç›´æ¥å‘¼ã¶ã¨é€£ç¶šç§»å‹•ã™ã‚‹ã®ã§ã€å°‘ã—ãƒ‡ã‚£ãƒ¬ã‚¤ã‚’ã‹ã‘ã‚‹ã¨è‡ªç„¶ã§ã™
                setTimeout(rollDice(true), 1000);
                break;
            case 5: // ç·‘ï¼šå®‰å®š
                addMoney(5000, "ç·‘ãƒã‚¹"); // å°‘é¡ã ãŒç¢ºå®Ÿãªãƒ—ãƒ©ã‚¹
                break;

            case 6: // æ©™ï¼šæŠ•è³‡ï¼ˆãƒã‚¤ãƒªã‚¹ã‚¯ãƒã‚¤ãƒªã‚¿ãƒ¼ãƒ³ï¼‰
                subMoney(10000, "æ©™ãƒã‚¹ æŠ•è³‡è²»ç”¨ï¼");
                updateMultiplier(0.1, "æ©™ãƒã‚¹ å°†æ¥ã¸ã®æŠ•è³‡ï¼");
                break;

            case 7: // èµ¤ï¼šå¤§é€†è»¢
                if (state.money < 0) {
                    state.money = Math.abs(state.money);
                    pushLog(`ã€èµ¤ãƒã‚¹ å¥‡è·¡ã®å¤§é€†è»¢ï¼ã€‘å€Ÿé‡‘ãŒãã®ã¾ã¾ãƒ—ãƒ©ã‚¹ã«è»¢ã˜ãŸï¼`);
                } else {
                    state.multiplier += 0.3;
                    updateMultiplier(0.3, "èµ¤ãƒã‚¹ çµ¶å¥½èª¿ï¼");
                }
                updateMoneyUI();
                break;
        }
    }

    /**
     * æœˆã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’é‡ã¿ä»˜ããƒ©ãƒ³ãƒ€ãƒ ã§ç”Ÿæˆã—ã¦ MONTHS_DATA ã‚’æ›´æ–°ã™ã‚‹
     */
    function generateMonthlyEvents(monthIdx) {
        const month = MONTHS_DATA[monthIdx];
        month.events = {}; // æ—¢å­˜ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚¯ãƒªã‚¢

        for (let day = 1; day <= month.days; day++) {
            const eventId = getRandomEventId();
            if (eventId) {
                month.events[day] = eventId;
            }
        }
    }

    /**
     * é‡ã¿ã«åŸºã¥ã„ã¦ãƒ©ãƒ³ãƒ€ãƒ ãªã‚¤ãƒ™ãƒ³ãƒˆIDã‚’ä¸€ã¤é¸ã¶
     */
    function getRandomEventId() {
        const weights = GAME_CONFIG.EVENT_WEIGHTS;
        const totalWeight = Object.values(weights).reduce((a, b) => a + b, 0) + GAME_CONFIG.EMPTY_WEIGHT;
        
        let random = Math.random() * totalWeight;
        
        // ã‚¤ãƒ™ãƒ³ãƒˆID 1ã€œ7 ã‚’åˆ¤å®š
        for (const [id, weight] of Object.entries(weights)) {
            if (random < weight) return parseInt(id);
            random -= weight;
        }
        
        // ã©ã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã‘ã‚Œã°ç©ºï¼ˆnullï¼‰
        return null;
    }

    /**
     * ç‰¹æ®Šã‚¤ãƒ™ãƒ³ãƒˆã‚’è¡¨ç¤ºã™ã‚‹
     * @param {string} title - ã‚¿ã‚¤ãƒˆãƒ«
     * @param {string} imgSrc - ç”»åƒURL
     * @param {string} text - èª¬æ˜æ–‡
     */
    function showSpecialEvent(ev) {
        document.getElementById('special-event-title').innerText = ev.title;
        document.getElementById('special-event-img').src = ev.img;
        document.getElementById('special-event-text').innerText = ev.text;
        
        const buttonContainer = document.getElementById('special-event-buttons');
        buttonContainer.innerHTML = ''; // ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªã‚¢

        if (ev.options) {
            // YES/NO ãªã©ã®é¸æŠè‚¢ãŒã‚ã‚‹å ´åˆ
            ev.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.innerText = opt.label;
                btn.style.cssText = "flex: 1; padding: 10px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; background: " + (opt.color || "#3498db") + "; color: white;";
                btn.onclick = () => {
                    closeSpecialEvent();
                    if (opt.action) opt.action();
                };
                buttonContainer.appendChild(btn);
            });
        } else {
            // é€šå¸¸ã®ã€ŒOKã€ã®ã¿ã®å ´åˆ
            const btn = document.createElement('button');
            btn.innerText = "OK";
            btn.style.cssText = "padding: 10px 40px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; background: #27ae60; color: white;";
            btn.onclick = closeSpecialEvent;
            buttonContainer.appendChild(btn);
        }
        
        document.getElementById('event-modal-overlay').style.display = 'flex';
        document.body.classList.add('modal-open');
    }


    /**
     * ç‰¹æ®Šã‚¤ãƒ™ãƒ³ãƒˆã‚’é–‰ã˜ã‚‹
     */
    function closeSpecialEvent() {
        document.getElementById('event-modal-overlay').style.display = 'none';
        document.body.classList.remove('modal-open');
        pushLog("ç‰¹æ®Šã‚¤ãƒ™ãƒ³ãƒˆã‚’ç¢ºèªã—ã¾ã—ãŸã€‚");
    }

    /**
     * ãƒ­ã‚°ã«æ–°ã—ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ ã™ã‚‹ï¼ˆæœ€æ–°ãŒä¸Šï¼‰
     */
    function pushLog(message) {
        const entry = document.createElement('div');
        entry.className = 'log-entry';
        
        // ç¾åœ¨ã®æ—¥ä»˜æƒ…å ±ãªã©ã‚’ä»˜ã‘ã¦ã‚‚é¢ç™½ã„ã§ã™
        const month = MONTHS_DATA[state.currentMonthIdx].name;
        entry.innerHTML = `<strong>[${month}${state.currentDay}æ—¥]</strong> ${message}`;
        
        // å…ˆé ­ã«æŒ¿å…¥
        UI.eventLog.prepend(entry);
        
        // è‡ªå‹•ã§ä¸€ç•ªä¸Šï¼ˆæœ€æ–°ï¼‰ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
        UI.eventLog.scrollTop = 0;
    }

    // ==========================================
    // 4. ãƒãƒãƒ¼ã‚·ã‚¹ãƒ†ãƒ 
    // ==========================================

    function addMoney(baseAmount, source) {
        const gain = Math.floor(baseAmount * state.multiplier);
        state.money += gain;
        updateMoneyUI();
        pushLog(`ã€${source}ã€‘${gain.toLocaleString()}å††ç²å¾—ï¼ (${baseAmount.toLocaleString()} Ã— ${state.multiplier.toFixed(1)}å€)`);
        return gain;
    }

    function subMoney(amount, source) {
        state.money -= amount;
        updateMoneyUI();
        pushLog(`ã€${source}ã€‘${amount.toLocaleString()}å††å¤±ã£ãŸâ€¦`);
        return amount;
    }

    function updateMoneyUI() {
        UI.money.innerText = state.money.toLocaleString() + "å††";
        UI.money.style.color = state.money < 0 ? GAME_CONFIG.COLORS.TEXT_DEBT : GAME_CONFIG.COLORS.TEXT_GOLD;
    }

    /**
     * å€ç‡ã‚’å¤‰æ›´ã—ã€UIæ›´æ–°ã¨ãƒ­ã‚°å‡ºåŠ›ã‚’è¡Œã†å…±é€šé–¢æ•°
     * @param {number} changeValue - å¢—æ¸›ã•ã›ã‚‹å€¤ï¼ˆ0.1 ã‚„ -0.2 ãªã©ï¼‰
     * @param {string} sourceName - ãƒ­ã‚°ã«è¡¨ç¤ºã™ã‚‹ã‚½ãƒ¼ã‚¹å
     */
    function updateMultiplier(changeValue, sourceName) {
        const oldMultiplier = state.multiplier;
        state.multiplier += changeValue;

        // --- ã‚¬ãƒ¼ãƒ‰ï¼šå€ç‡ã®æœ€å°å€¤ã‚’ 0.1 ã«å›ºå®šï¼ˆ0ä»¥ä¸‹ã§åå…¥ãŒæ¶ˆãˆãªã„ã‚ˆã†ã«ï¼‰ ---
        if (state.multiplier < 0.1) state.multiplier = 0.1;
        
        // --- ã‚¬ãƒ¼ãƒ‰ï¼šæœ€å¤§å€¤ã‚’ 10.0 ãªã©ã«è¨­å®šï¼ˆã‚¤ãƒ³ãƒ•ãƒ¬é˜²æ­¢ãƒ»ãŠå¥½ã¿ã§ï¼‰ ---
        if (state.multiplier > 10.0) state.multiplier = 10.0;

        // UIæ›´æ–°
        UI.multiplier.innerText = state.multiplier.toFixed(1);
        
        // ãƒ­ã‚°å‡ºåŠ›
        const sign = changeValue >= 0 ? "ã‚¢ãƒƒãƒ—" : "ãƒ€ã‚¦ãƒ³";
        const diff = Math.abs(changeValue).toFixed(1);
        pushLog(`ã€${sourceName}ã€‘å€ç‡ãŒ ${diff} ${sign}ï¼ (x${oldMultiplier.toFixed(1)} â†’ x${state.multiplier.toFixed(1)})`);
    }

    // ==========================================
    // 5. ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆã‚µã‚¤ã‚³ãƒ­ãƒ»ãƒœãƒ¼ãƒŠã‚¹ï¼‰
    // ==========================================

    function rollDice(isFree = false) {
        if (document.body.classList.contains('modal-open')) return;

        // subMoney ã‚’ä½¿ã†ã“ã¨ã§ãƒ­ã‚°ã«ã‚‚æ®‹ã‚Šã€å€Ÿé‡‘ï¼ˆãƒã‚¤ãƒŠã‚¹ï¼‰ã‚‚è¨±å®¹ã•ã‚Œã¾ã™
        if (!isFree) {
            subMoney(GAME_CONFIG.DICE_COST, "ã‚µã‚¤ã‚³ãƒ­ä»£");
        }

        const dice = Math.floor(Math.random() * 4) + 1;
        movePlayer(dice);
    }

    
    function movePlayer(steps) {
        state.currentDay += steps;
        const month = MONTHS_DATA[state.currentMonthIdx];

        if (state.currentDay > month.days) {
            state.currentDay -= month.days;
            state.currentMonthIdx = (state.currentMonthIdx + 1) % 12;

            generateMonthlyEvents(state.currentMonthIdx);

            updateCalendarVisuals();
            updateView(true); 
            showBonusModal();UI.statusLog.innerText = `${steps} é€²ã¿ã¾ã—ãŸï¼ˆç¾åœ¨: ç¿Œæœˆ${state.currentDay}æ—¥ï¼‰`;
        } else {
            UI.statusLog.innerText = `${steps} é€²ã¿ã¾ã—ãŸï¼ˆç¾åœ¨: ${state.currentDay}æ—¥ï¼‰`;
            updateView();
        }
    }

    // function movePlayer(steps) {
    //     let remainingSteps = steps;
    //     let stopReason = "";

    //     // 1æ­©ãšã¤é€²ã‚“ã§ã€ç‰¹æ®Šã‚¤ãƒ™ãƒ³ãƒˆãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ã™ã‚‹
    //     for (let i = 0; i < steps; i++) {
    //         state.currentDay++;
    //         remainingSteps--;

    //         const month = MONTHS_DATA[state.currentMonthIdx];

    //         // æœˆã‚’ã¾ãŸãåˆ¤å®š
    //         if (state.currentDay > month.days) {
    //             state.currentDay = 1; // 1æ—¥ã«ãƒªã‚»ãƒƒãƒˆ
    //             state.currentMonthIdx = (state.currentMonthIdx + 1) % 12;
    //             generateMonthlyEvents(state.currentMonthIdx);
    //             updateCalendarVisuals();
                
    //             // æœˆã¾ãŸãã¯å¼·åˆ¶åœæ­¢ï¼ˆãƒœãƒ¼ãƒŠã‚¹é¸æŠãŒã‚ã‚‹ãŸã‚ï¼‰
    //             stopReason = "æœˆåˆã‚ã®ãŸã‚åœæ­¢ã—ã¾ã™";
    //             break; 
    //         }

    //         // --- ã“ã“ãŒé‡è¦ï¼šç‰¹æ®Šã‚¤ãƒ™ãƒ³ãƒˆã®æ—¥ã‹ãƒã‚§ãƒƒã‚¯ ---
    //         const dateKey = `${state.currentMonthIdx + 1}-${state.currentDay}`;
    //         if (SPECIAL_DATE_EVENTS[dateKey]) {
    //             stopReason = "ç‰¹æ®Šã‚¤ãƒ™ãƒ³ãƒˆã®ãŸã‚åœæ­¢ã—ã¾ã™ï¼";
    //             break; // ãƒ«ãƒ¼ãƒ—ã‚’æŠœã‘ã¦ã€æ®‹ã‚Šã®æ­©æ•°ã‚’ç ´æ£„ã™ã‚‹
    //         }
    //     }

    //     // æœ€çµ‚çš„ãªä½ç½®ã§è¡¨ç¤ºã‚’æ›´æ–°
    //     if (stopReason.includes("æœˆåˆã‚")) {
    //         updateView(true); // ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ã‚­ãƒƒãƒ—ã—ã¦ãƒœãƒ¼ãƒŠã‚¹ã¸
    //         showBonusModal();
    //         UI.statusLog.innerText = `${steps-remainingSteps} é€²ã¿ã¾ã—ãŸï¼ˆç¾åœ¨: ç¿Œæœˆ${state.currentDay}æ—¥ï¼‰`;
    //     } else {
    //         updateView(); // é€šå¸¸ã¾ãŸã¯ç‰¹æ®Šã‚¤ãƒ™ãƒ³ãƒˆå®Ÿè¡Œ
    //         UI.statusLog.innerText = `${steps} é€²ã¿ã¾ã—ãŸï¼ˆç¾åœ¨: ${state.currentDay}æ—¥ï¼‰`;
    //     }
    // }

    function showBonusModal() {
        UI.modal.style.display = 'flex';
        document.body.classList.add('modal-open');
    }

    function applyBonus(type) {
        let msg = "";
        if (type === 'money') {
            const gain = addMoney(GAME_CONFIG.BONUS_MONEY_BASE, "ãƒœãƒ¼ãƒŠã‚¹");
            msg = `æ‰€æŒé‡‘ãŒ ${gain.toLocaleString()}å††å¢—ãˆã¾ã—ãŸï¼`;
        } else if (type === 'move') {
            state.currentDay += GAME_CONFIG.BONUS_MOVE_STEPS;
            msg = `ã€ãƒœãƒ¼ãƒŠã‚¹ã€‘ã•ã‚‰ã« ${GAME_CONFIG.BONUS_MOVE_STEPS}ãƒã‚¹é€²ã¿ã¾ã—ãŸï¼`;
            pushLog(msg);
        } else if (type === 'multiplier') {
            state.multiplier += GAME_CONFIG.BONUS_MULTIPLIER_ADD;
            msg = `ã€ãƒœãƒ¼ãƒŠã‚¹ã€‘åå…¥å€ç‡ãŒ ${GAME_CONFIG.BONUS_MULTIPLIER_ADD} ä¸ŠãŒã‚Šã¾ã—ãŸï¼`;
            pushLog(msg);
        }

        UI.modal.style.display = 'none';
        document.body.classList.remove('modal-open');
        UI.statusLog.innerText = msg;
        updateView(); 
    }

    // ã‚²ãƒ¼ãƒ é–‹å§‹
    initGrid();
</script>
</body>
</html>